<div class="container-fluid">
  <div class="form-group">
    <div class="row">
      <mat-radio-group [(ngModel)]="rdFactura">
          <mat-radio-button value="C">Factura de compra</mat-radio-button>
          <mat-radio-button value="V">Factura de venta</mat-radio-button>
      </mat-radio-group>
    </div>
    <div class="row">
      <div class="col-2">
        <mat-form-field>
          <mat-label>Nro. de factura</mat-label>
          <input matInput [(ngModel)]="codFactura">
          <mat-error>
            Email is <strong>required</strong>
          </mat-error>
        </mat-form-field>
        <!-- <mat-form-field class="example-full-width"> // ------------ TOBE
          <mat-label>Assignee</mat-label>
          <input type="text" matInput [formControl]="myControl" [matAutocomplete]="auto">
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
            <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
              {{option.name}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field> -->
      </div>
      <div class="col-2">
        <mat-form-field>
          <mat-label>{{getTipoPersona()}}</mat-label>
          <input matInput [(ngModel)]="codPersona">
        </mat-form-field>
      </div>
      <div class="col-2">
        <mat-form-field>
          <mat-label>Fecha de factura</mat-label>
          <!-- <input matInput [matDatepickerFilter]="myFilter" [matDatepicker]="picker" [(ngModel)]="fecha"> -->
          <input matInput [matDatepicker]="picker" [(ngModel)]="fecha">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="form-group">
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" (change)="getTotalCost()">
        <!-- Checkbox Column -->
        <ng-container matColumnDef="insert">
          <th mat-header-cell *matHeaderCellDef="let row">
            <mat-checkbox [(ngModel)]="chkAll" [value]="chkAll" (ngModelChange)="selectAll()">
            </mat-checkbox>
            <button mat-button (click)="btnClick()">
              <mat-icon>add</mat-icon>
            </button>
          </th>
          <td mat-cell *matCellDef="let transaction">
            <mat-checkbox [(ngModel)]="transaction.insert">
            </mat-checkbox>
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <button mat-button (click)="clear()">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>
        <!-- Item Column -->
        <ng-container matColumnDef="item">
          <th mat-header-cell *matHeaderCellDef> CÃ³digo Producto </th>
          <td mat-cell *matCellDef="let transaction">
            <!-- <div class="col-9"> -->
            <input type="text" class="form-control" [value]="transaction.idItem" [(ngModel)]="transaction.idItem"
              name="item" (keyup)="find(transaction)">
            <!-- </div> -->
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Nombre </th>
          <td mat-cell *matCellDef="let transaction">
            <div class="col-11">
              <input readonly type="text" class="form-control" [value]="transaction.name" [(ngModel)]="transaction.name"
                name="name">
            </div>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>
        <!-- Cost Column -->
        <ng-container matColumnDef="cost">
          <th mat-header-cell *matHeaderCellDef> Precio Unitario </th>
          <td mat-cell *matCellDef="let transaction">
            <div class="col-8">
              <input [readonly]="rdFactura=='V'" type="number" class="form-control" [(ngModel)]="transaction.cost" name="cost"
                value="{{transaction.cost}}">
            </div>
          </td>
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container matColumnDef="cant">
          <th mat-header-cell *matHeaderCellDef> Cantidad </th>
          <td mat-cell *matCellDef="let transaction">
            <div class="col-8">
              <input type="number" class="form-control" name="cant" [(ngModel)]="transaction.cant"
                [value]="transaction.cant">
            </div>
          </td>
          <td mat-footer-cell *matFooterCellDef> Total </td>
        </ng-container>

        <ng-container matColumnDef="subtotal">
          <th mat-header-cell *matHeaderCellDef> Subtotal </th>
          <td mat-cell *matCellDef="let transaction">
            <label>{{getSubtotal(transaction) | currency:'CLP'}}</label>
          </td>
          <td mat-footer-cell *matFooterCellDef> {{getTotalCost() | currency : 'CLP'}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumns; sticky: true"></tr>
      </table>
    </div>
  </div>
  <div class="form-group">
    <button type="submit" class="btn btn-dark" (click)="OnSubmit()">Confirmar</button>
  </div>
</div>
